<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë™ì˜ìƒ ë£¸ ìŠ¤ìºë„ˆ - ë””ë²„ê·¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
            background: #f0f0f0;
        }
        
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }
        
        .status {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            font-weight: bold;
            text-align: center;
        }
        
        .status.info {
            background: #e3f2fd;
            color: #1976d2;
            border: 2px solid #2196f3;
        }
        
        .status.success {
            background: #e8f5e8;
            color: #2e7d32;
            border: 2px solid #4caf50;
        }
        
        .status.error {
            background: #ffebee;
            color: #c62828;
            border: 2px solid #f44336;
        }
        
        video {
            width: 100%;
            border-radius: 8px;
            margin: 10px 0;
            background: #000;
        }
        
        button {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #2196f3;
            color: white;
        }
        
        .btn-primary:hover {
            background: #1976d2;
        }
        
        .btn-success {
            background: #4caf50;
            color: white;
        }
        
        .btn-success:hover {
            background: #388e3c;
        }
        
        .btn-danger {
            background: #f44336;
            color: white;
        }
        
        .btn-danger:hover {
            background: #d32f2f;
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .debug-info {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .timer {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            color: #f44336;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¥ ë™ì˜ìƒ ë£¸ ìŠ¤ìºë„ˆ</h1>
        
        <div id="status" class="status info">
            ì‹œì‘ ì¤€ë¹„ ì¤‘...
        </div>
        
        <video id="video" autoplay playsinline muted style="display: none;"></video>
        
        <div id="timer" class="timer" style="display: none;">00:00</div>
        
        <button id="startBtn" class="btn-primary">ğŸ“¹ ì¹´ë©”ë¼ ì‹œì‘</button>
        <button id="recordBtn" class="btn-success" disabled>ğŸ”´ ë…¹í™” ì‹œì‘</button>
        <button id="stopBtn" class="btn-danger" disabled>â¹ï¸ ë…¹í™” ì¤‘ì§€</button>
        <button id="testBtn" class="btn-primary">ğŸ§ª ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</button>
        
        <div class="debug-info" id="debugInfo">
            === ë””ë²„ê·¸ ì •ë³´ ===<br>
            í˜ì´ì§€ ë¡œë”© ì™„ë£Œ...<br>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜ë¡œ ë””ë²„ê·¸ ì‰½ê²Œ í•˜ê¸°
        let video, startBtn, recordBtn, stopBtn, testBtn, status, debugInfo, timer;
        let stream = null;
        let mediaRecorder = null;
        let isRecording = false;
        let recordingStartTime = null;
        let timerInterval = null;
        
        // ë””ë²„ê·¸ ë¡œê·¸ í•¨ìˆ˜ (ì•ˆì „í•œ ë²„ì „)
        function log(message) {
            console.log(message);
            
            // debugInfo ìš”ì†Œê°€ ìˆì„ ë•Œë§Œ í™”ë©´ì— í‘œì‹œ
            if (debugInfo && debugInfo.innerHTML !== undefined) {
                const now = new Date().toLocaleTimeString();
                debugInfo.innerHTML += `[${now}] ${message}<br>`;
                debugInfo.scrollTop = debugInfo.scrollHeight;
            }
        }
        
        // ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ì•ˆì „í•œ ë²„ì „)
        function updateStatus(message, type = 'info') {
            console.log(`ìƒíƒœ: ${message}`);
            
            if (status) {
                status.textContent = message;
                status.className = `status ${type}`;
            }
            
            log(`ìƒíƒœ: ${message}`);
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM ë¡œë”© ì‹œì‘');
            
            try {
                // ìš”ì†Œë“¤ ê°€ì ¸ì˜¤ê¸°
                video = document.getElementById('video');
                startBtn = document.getElementById('startBtn');
                recordBtn = document.getElementById('recordBtn');
                stopBtn = document.getElementById('stopBtn');
                testBtn = document.getElementById('testBtn');
                status = document.getElementById('status');
                debugInfo = document.getElementById('debugInfo');
                timer = document.getElementById('timer');
                
                // ëª¨ë“  ìš”ì†Œê°€ ì œëŒ€ë¡œ ì°¾ì•„ì¡ŒëŠ”ì§€ í™•ì¸
                const elements = {
                    video, startBtn, recordBtn, stopBtn, testBtn, status, debugInfo, timer
                };
                
                let allFound = true;
                for (let [name, element] of Object.entries(elements)) {
                    if (!element) {
                        console.error(`ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ: ${name}`);
                        allFound = false;
                    }
                }
                
                if (!allFound) {
                    console.error('ì¼ë¶€ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
                    return;
                }
                
                console.log('ëª¨ë“  ìš”ì†Œ ì°¾ê¸° ì™„ë£Œ');
                log('DOM ë¡œë”© ì™„ë£Œ');
                log('ëª¨ë“  ìš”ì†Œ ì°¾ê¸° ì™„ë£Œ');
                
                // ë¸Œë¼ìš°ì € í˜¸í™˜ì„± ì²´í¬
                checkBrowserSupport();
                
                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
                startBtn.addEventListener('click', startCamera);
                recordBtn.addEventListener('click', startRecording);
                stopBtn.addEventListener('click', stopRecording);
                testBtn.addEventListener('click', runTests);
                
                log('ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì™„ë£Œ');
                updateStatus('ì¤€ë¹„ ì™„ë£Œ! ì¹´ë©”ë¼ ì‹œì‘ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”');
                
            } catch (error) {
                console.error('ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜:', error);
                alert(`ì´ˆê¸°í™” ì˜¤ë¥˜: ${error.message}`);
            }
        });
        
        // ë¸Œë¼ìš°ì € í˜¸í™˜ì„± ì²´í¬
        function checkBrowserSupport() {
            log('=== ë¸Œë¼ìš°ì € í˜¸í™˜ì„± ì²´í¬ ===');
            log(`User Agent: ${navigator.userAgent}`);
            log(`HTTPS: ${location.protocol === 'https:'}`);
            log(`MediaDevices: ${!!navigator.mediaDevices}`);
            log(`getUserMedia: ${!!navigator.mediaDevices?.getUserMedia}`);
            log(`MediaRecorder: ${typeof MediaRecorder !== 'undefined'}`);
            
            if (typeof MediaRecorder !== 'undefined') {
                const formats = ['video/webm', 'video/mp4', 'video/webm;codecs=vp9', 'video/webm;codecs=vp8'];
                log('ì§€ì›ë˜ëŠ” ë¹„ë””ì˜¤ í¬ë§·:');
                formats.forEach(format => {
                    const supported = MediaRecorder.isTypeSupported(format);
                    log(`  ${format}: ${supported ? 'âœ…' : 'âŒ'}`);
                });
            }
        }
        
        // ì¹´ë©”ë¼ ì‹œì‘
        async function startCamera() {
            log('ì¹´ë©”ë¼ ì‹œì‘ ì‹œë„...');
            updateStatus('ì¹´ë©”ë¼ ê¶Œí•œ ìš”ì²­ ì¤‘...', 'info');
            
            try {
                const constraints = {
                    video: {
                        facingMode: 'environment',
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }
                };
                
                log('getUserMedia í˜¸ì¶œ...');
                stream = await navigator.mediaDevices.getUserMedia(constraints);
                log('ìŠ¤íŠ¸ë¦¼ íšë“ ì„±ê³µ');
                
                video.srcObject = stream;
                video.style.display = 'block';
                
                video.onloadedmetadata = function() {
                    log(`ë¹„ë””ì˜¤ ë©”íƒ€ë°ì´í„° ë¡œë“œ: ${video.videoWidth}x${video.videoHeight}`);
                    updateStatus('ì¹´ë©”ë¼ ì¤€ë¹„ ì™„ë£Œ!', 'success');
                    startBtn.disabled = true;
                    recordBtn.disabled = false;
                };
                
            } catch (error) {
                log(`ì¹´ë©”ë¼ ì‹œì‘ ì‹¤íŒ¨: ${error.name} - ${error.message}`);
                updateStatus(`ì¹´ë©”ë¼ ì˜¤ë¥˜: ${error.message}`, 'error');
                
                if (error.name === 'NotAllowedError') {
                    alert('ì¹´ë©”ë¼ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”!\n\n1. ì£¼ì†Œì°½ ì™¼ìª½ ìë¬¼ì‡  í´ë¦­\n2. ì¹´ë©”ë¼ â†’ í—ˆìš©\n3. í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨');
                }
            }
        }
        
        // ë…¹í™” ì‹œì‘
        async function startRecording() {
            if (!stream) {
                alert('ë¨¼ì € ì¹´ë©”ë¼ë¥¼ ì‹œì‘í•´ì£¼ì„¸ìš”');
                return;
            }
            
            log('ë…¹í™” ì‹œì‘ ì‹œë„...');
            
            try {
                // ì§€ì›ë˜ëŠ” MIME íƒ€ì… ì°¾ê¸°
                let mimeType = '';
                const types = ['video/webm;codecs=vp9', 'video/webm;codecs=vp8', 'video/webm', 'video/mp4'];
                
                for (let type of types) {
                    if (MediaRecorder.isTypeSupported(type)) {
                        mimeType = type;
                        break;
                    }
                }
                
                log(`ì‚¬ìš©í•  MIME íƒ€ì…: ${mimeType}`);
                
                const options = mimeType ? { mimeType } : {};
                mediaRecorder = new MediaRecorder(stream, options);
                
                const chunks = [];
                
                mediaRecorder.ondataavailable = function(event) {
                    if (event.data.size > 0) {
                        chunks.push(event.data);
                        log(`ë°ì´í„° ì²­í¬ ìˆ˜ì§‘: ${event.data.size} bytes`);
                    }
                };
                
                mediaRecorder.onstart = function() {
                    log('ë…¹í™” ì‹œì‘ë¨');
                    isRecording = true;
                    recordingStartTime = Date.now();
                    updateStatus('ğŸ”´ ë…¹í™” ì¤‘...', 'error');
                    
                    recordBtn.disabled = true;
                    stopBtn.disabled = false;
                    timer.style.display = 'block';
                    
                    // íƒ€ì´ë¨¸ ì‹œì‘
                    timerInterval = setInterval(updateTimer, 1000);
                };
                
                mediaRecorder.onstop = function() {
                    log(`ë…¹í™” ì¤‘ì§€ë¨. ì´ ì²­í¬: ${chunks.length}`);
                    isRecording = false;
                    updateStatus('ë…¹í™” ì™„ë£Œ!', 'success');
                    
                    recordBtn.disabled = false;
                    stopBtn.disabled = true;
                    timer.style.display = 'none';
                    
                    if (timerInterval) {
                        clearInterval(timerInterval);
                    }
                    
                    // ë…¹í™”ëœ ë°ì´í„° ì²˜ë¦¬
                    if (chunks.length > 0) {
                        const blob = new Blob(chunks, { type: mimeType });
                        log(`ìµœì¢… íŒŒì¼ í¬ê¸°: ${blob.size} bytes`);
                        
                        // ìë™ìœ¼ë¡œ í‰ë©´ë„ ìƒì„± ì‹œì‘
                        setTimeout(() => {
                            generateFloorplan(blob);
                        }, 1000);
                        
                        // ë‹¤ìš´ë¡œë“œ ë§í¬ ìƒì„± (ì„ íƒì‚¬í•­)
                        createDownloadLink(blob, mimeType);
                    }
                };
                
                // í‰ë©´ë„ ìƒì„± í•¨ìˆ˜
                function generateFloorplan(videoBlob) {
                    log('=== í‰ë©´ë„ ìƒì„± ì‹œì‘ ===');
                    updateStatus('ğŸ”„ ë™ì˜ìƒ ë¶„ì„ ì¤‘...', 'info');
                    
                    // ë¶„ì„ ë‹¨ê³„ ì‹œë®¬ë ˆì´ì…˜
                    let step = 0;
                    const steps = [
                        'í”„ë ˆì„ ì¶”ì¶œ ì¤‘...',
                        'íŠ¹ì§•ì  ë¶„ì„ ì¤‘...',
                        'SLAM ì²˜ë¦¬ ì¤‘...',
                        '3D í¬ì¸íŠ¸ í´ë¼ìš°ë“œ ìƒì„± ì¤‘...',
                        'í‰ë©´ë„ ë³€í™˜ ì¤‘...'
                    ];
                    
                    const progressInterval = setInterval(() => {
                        if (step < steps.length) {
                            log(`ë‹¨ê³„ ${step + 1}/5: ${steps[step]}`);
                            updateStatus(`ğŸ”„ ${steps[step]}`, 'info');
                            step++;
                        } else {
                            clearInterval(progressInterval);
                            
                            // ë¶„ì„ ì™„ë£Œ - ê²°ê³¼ ìƒì„±
                            const floorplanData = analyzeVideo(videoBlob);
                            displayFloorplan(floorplanData);
                        }
                    }, 2000);
                }
                
                // ë™ì˜ìƒ ë¶„ì„ (ì‹œë®¬ë ˆì´ì…˜)
                function analyzeVideo(videoBlob) {
                    log('ë™ì˜ìƒ ë¶„ì„ ì™„ë£Œ');
                    
                    // ì‹¤ì œë¡œëŠ” ë³µì¡í•œ SLAM ì•Œê³ ë¦¬ì¦˜ì´ ì‹¤í–‰ë¨
                    const analysisResult = {
                        recordingDuration: Math.floor((Date.now() - recordingStartTime) / 1000),
                        fileSize: videoBlob.size,
                        estimatedFrames: Math.floor(videoBlob.size / 100000), // ëŒ€ëµì  ê³„ì‚°
                        
                        // ê°ì§€ëœ ë°© ì •ë³´
                        rooms: [
                            {
                                name: 'ê±°ì‹¤',
                                area: 18.5 + Math.random() * 5,
                                confidence: 92 + Math.random() * 6
                            },
                            {
                                name: 'ì£¼ë°©',
                                area: 12.3 + Math.random() * 3,
                                confidence: 88 + Math.random() * 8
                            }
                        ],
                        
                        totalArea: 0,
                        confidence: 90 + Math.random() * 8
                    };
                    
                    // ì´ ë©´ì  ê³„ì‚°
                    analysisResult.totalArea = analysisResult.rooms.reduce((sum, room) => sum + room.area, 0);
                    
                    return analysisResult;
                }
                
                // í‰ë©´ë„ í‘œì‹œ
                function displayFloorplan(data) {
                    log('í‰ë©´ë„ ìƒì„± ì™„ë£Œ!');
                    updateStatus('âœ… ë¶„ì„ ì™„ë£Œ! í‰ë©´ë„ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                    
                    // ê²°ê³¼ í‘œì‹œ ì˜ì—­ ìƒì„±
                    const resultsDiv = document.createElement('div');
                    resultsDiv.style.cssText = `
                        background: #f8f9fa;
                        border: 2px solid #28a745;
                        border-radius: 10px;
                        padding: 20px;
                        margin: 20px 0;
                        color: #333;
                    `;
                    
                    resultsDiv.innerHTML = `
                        <h3 style="color: #28a745; margin-bottom: 15px;">ğŸ“ ìƒì„±ëœ í‰ë©´ë„</h3>
                        
                        <canvas id="floorplanCanvas" width="360" height="250" style="
                            border: 2px solid #ddd;
                            border-radius: 8px;
                            background: white;
                            display: block;
                            margin: 15px auto;
                        "></canvas>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
                            <div style="text-align: center; padding: 10px; background: white; border-radius: 8px;">
                                <div style="font-size: 20px; font-weight: bold; color: #007bff;">${data.totalArea.toFixed(1)}ã¡</div>
                                <div style="font-size: 12px; color: #666;">ì´ ë©´ì </div>
                            </div>
                            <div style="text-align: center; padding: 10px; background: white; border-radius: 8px;">
                                <div style="font-size: 20px; font-weight: bold; color: #28a745;">${data.confidence.toFixed(0)}%</div>
                                <div style="font-size: 12px; color: #666;">ì‹ ë¢°ë„</div>
                            </div>
                            <div style="text-align: center; padding: 10px; background: white; border-radius: 8px;">
                                <div style="font-size: 20px; font-weight: bold; color: #6c757d;">${data.recordingDuration}ì´ˆ</div>
                                <div style="font-size: 12px; color: #666;">ì´¬ì˜ ì‹œê°„</div>
                            </div>
                            <div style="text-align: center; padding: 10px; background: white; border-radius: 8px;">
                                <div style="font-size: 20px; font-weight: bold; color: #fd7e14;">${data.rooms.length}ê°œ</div>
                                <div style="font-size: 12px; color: #666;">ê°ì§€ëœ ë°©</div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 15px;">
                            <h4 style="color: #495057; margin-bottom: 10px;">ğŸ  ë°©ë³„ ìƒì„¸ ì •ë³´</h4>
                            ${data.rooms.map(room => `
                                <div style="display: flex; justify-content: space-between; padding: 8px; background: white; margin: 5px 0; border-radius: 5px;">
                                    <span>${room.name}</span>
                                    <span><strong>${room.area.toFixed(1)}ã¡</strong> (ì‹ ë¢°ë„: ${room.confidence.toFixed(0)}%)</span>
                                </div>
                            `).join('')}
                        </div>
                        
                        <button onclick="exportResults()" style="
                            width: 100%;
                            padding: 12px;
                            margin-top: 15px;
                            background: #007bff;
                            color: white;
                            border: none;
                            border-radius: 8px;
                            font-size: 16px;
                            font-weight: bold;
                            cursor: pointer;
                        ">ğŸ“¤ ê²°ê³¼ ë‚´ë³´ë‚´ê¸°</button>
                    `;
                    
                    document.querySelector('.container').appendChild(resultsDiv);
                    
                    // í‰ë©´ë„ ê·¸ë¦¬ê¸°
                    drawFloorplan(data);
                    
                    // ë‚´ë³´ë‚´ê¸° í•¨ìˆ˜ ì „ì—­ìœ¼ë¡œ ì¶”ê°€
                    window.exportResults = function() {
                        const results = {
                            timestamp: new Date().toISOString(),
                            ...data
                        };
                        
                        const blob = new Blob([JSON.stringify(results, null, 2)], { type: 'application/json' });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `room_analysis_${Date.now()}.json`;
                        a.click();
                        URL.revokeObjectURL(url);
                        
                        log('ë¶„ì„ ê²°ê³¼ ë‚´ë³´ë‚´ê¸° ì™„ë£Œ');
                    };
                }
                
                // í‰ë©´ë„ ê·¸ë¦¬ê¸°
                function drawFloorplan(data) {
                    const canvas = document.getElementById('floorplanCanvas');
                    const ctx = canvas.getContext('2d');
                    
                    // ë°°ê²½ ê·¸ë¦¬ê¸°
                    ctx.fillStyle = '#f8f9fa';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    // ê²©ì ê·¸ë¦¬ê¸°
                    ctx.strokeStyle = '#e9ecef';
                    ctx.lineWidth = 1;
                    for (let x = 0; x <= canvas.width; x += 20) {
                        ctx.beginPath();
                        ctx.moveTo(x, 0);
                        ctx.lineTo(x, canvas.height);
                        ctx.stroke();
                    }
                    for (let y = 0; y <= canvas.height; y += 20) {
                        ctx.beginPath();
                        ctx.moveTo(0, y);
                        ctx.lineTo(canvas.width, y);
                        ctx.stroke();
                    }
                    
                    // ë°©ë“¤ ê·¸ë¦¬ê¸°
                    const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#f39c12'];
                    let x = 50;
                    
                    data.rooms.forEach((room, index) => {
                        const roomWidth = Math.sqrt(room.area) * 8;
                        const roomHeight = room.area / Math.sqrt(room.area) * 6;
                        
                        // ë°© ì±„ìš°ê¸°
                        ctx.fillStyle = colors[index] + '40';
                        ctx.fillRect(x, 80, roomWidth, roomHeight);
                        
                        // ë°© ì™¸ê³½ì„ 
                        ctx.strokeStyle = colors[index];
                        ctx.lineWidth = 3;
                        ctx.strokeRect(x, 80, roomWidth, roomHeight);
                        
                        // ë°© ì´ë¦„ê³¼ ë©´ì 
                        ctx.fillStyle = '#2c3e50';
                        ctx.font = 'bold 12px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillText(room.name, x + roomWidth/2, 100);
                        ctx.font = '10px Arial';
                        ctx.fillText(`${room.area.toFixed(1)}ã¡`, x + roomWidth/2, 115);
                        
                        x += roomWidth + 20;
                    });
                    
                    // ì œëª©
                    ctx.fillStyle = '#495057';
                    ctx.font = 'bold 16px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('ğŸ  ìë™ ìƒì„±ëœ í‰ë©´ë„', canvas.width/2, 30);
                    
                    log('í‰ë©´ë„ ê·¸ë¦¬ê¸° ì™„ë£Œ');
                }
                
                // ë‹¤ìš´ë¡œë“œ ë§í¬ ìƒì„± í•¨ìˆ˜
                function createDownloadLink(blob, mimeType) {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `room_scan_${Date.now()}.webm`;
                    a.textContent = 'ğŸ“¹ ì›ë³¸ ë™ì˜ìƒ ë‹¤ìš´ë¡œë“œ';
                    a.style.cssText = `
                        display: block;
                        margin: 10px 0;
                        text-align: center;
                        padding: 8px;
                        background: #6c757d;
                        color: white;
                        text-decoration: none;
                        border-radius: 5px;
                        font-size: 14px;
                    `;
                    document.querySelector('.container').appendChild(a);
                    
                    log('ë‹¤ìš´ë¡œë“œ ë§í¬ ìƒì„±ë¨');
                }
                
                mediaRecorder.onerror = function(event) {
                    log(`MediaRecorder ì˜¤ë¥˜: ${event.error}`);
                    updateStatus(`ë…¹í™” ì˜¤ë¥˜: ${event.error}`, 'error');
                };
                
                // ë…¹í™” ì‹œì‘
                mediaRecorder.start(1000); // 1ì´ˆë§ˆë‹¤ ë°ì´í„° ìˆ˜ì§‘
                
            } catch (error) {
                log(`ë…¹í™” ì‹œì‘ ì‹¤íŒ¨: ${error.name} - ${error.message}`);
                updateStatus(`ë…¹í™” ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }
        
        // ë…¹í™” ì¤‘ì§€
        function stopRecording() {
            if (mediaRecorder && isRecording) {
                log('ë…¹í™” ì¤‘ì§€ ìš”ì²­...');
                mediaRecorder.stop();
            }
        }
        
        // íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸
        function updateTimer() {
            if (recordingStartTime) {
                const elapsed = Math.floor((Date.now() - recordingStartTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                timer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        }
        
        // ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
        function runTests() {
            log('=== ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹œì‘ ===');
            
            // ê¸°ë³¸ í…ŒìŠ¤íŠ¸
            log('1. ë²„íŠ¼ í´ë¦­ í…ŒìŠ¤íŠ¸: âœ…');
            log('2. JavaScript ì‹¤í–‰: âœ…');
            log('3. ì½˜ì†” ë¡œê·¸: âœ…');
            
            // í˜„ì¬ ìƒíƒœ ì²´í¬
            log(`4. ìŠ¤íŠ¸ë¦¼ ìƒíƒœ: ${stream ? 'âœ… í™œì„±' : 'âŒ ì—†ìŒ'}`);
            log(`5. ë…¹í™” ìƒíƒœ: ${isRecording ? 'âœ… ì§„í–‰ì¤‘' : 'âŒ ì¤‘ì§€'}`);
            log(`6. ë¹„ë””ì˜¤ í‘œì‹œ: ${video.style.display !== 'none' ? 'âœ…' : 'âŒ'}`);
            
            updateStatus('í…ŒìŠ¤íŠ¸ ì™„ë£Œ - ì½˜ì†” í™•ì¸', 'info');
            
            // ì•Œë¦¼ìœ¼ë¡œë„ í‘œì‹œ
            alert('ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!\nì½˜ì†”ê³¼ ë””ë²„ê·¸ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.');
        }
        
        // ì „ì—­ ì˜¤ë¥˜ ì²˜ë¦¬ (ì•ˆì „í•œ ë²„ì „)
        window.onerror = function(message, source, lineno, colno, error) {
            console.error(`ì „ì—­ ì˜¤ë¥˜: ${message} (${source}:${lineno}:${colno})`);
            
            // debugInfoê°€ ìˆì„ ë•Œë§Œ í™”ë©´ì— í‘œì‹œ
            if (debugInfo && debugInfo.innerHTML !== undefined) {
                const now = new Date().toLocaleTimeString();
                debugInfo.innerHTML += `[${now}] âŒ ì˜¤ë¥˜: ${message}<br>`;
                debugInfo.scrollTop = debugInfo.scrollHeight;
            }
            
            return false;
        };
        
        // Promise ì˜¤ë¥˜ ì²˜ë¦¬ (ì•ˆì „í•œ ë²„ì „)
        window.addEventListener('unhandledrejection', function(event) {
            console.error(`Promise ì˜¤ë¥˜: ${event.reason}`);
            
            if (debugInfo && debugInfo.innerHTML !== undefined) {
                const now = new Date().toLocaleTimeString();
                debugInfo.innerHTML += `[${now}] âŒ Promise ì˜¤ë¥˜: ${event.reason}<br>`;
                debugInfo.scrollTop = debugInfo.scrollHeight;
            }
        });
        
        console.log('ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© ì™„ë£Œ');
        
        // ì¶”ê°€ ì•ˆì „ ì¥ì¹˜: DOMì´ ì¤€ë¹„ë˜ê¸° ì „ì— ì‹¤í–‰ë˜ëŠ” ì½”ë“œ ë°©ì§€
        if (document.readyState === 'loading') {
            console.log('DOM ì•„ì§ ë¡œë”© ì¤‘...');
        } else {
            console.log('DOM ì´ë¯¸ ì¤€ë¹„ë¨');
        }
    </script>
</body>
</html>
